# Data Model: Personal Recommendations

**Date**: 2026-02-13

## Entities

### CatalogEntry

A movie or series from kino.pub stored as a recommendation
candidate. Fetched incrementally via the `catalog` command.

| Field | Type | Description |
|-------|------|-------------|
| id | int | kino.pub item identifier (primary key) |
| title | str | Display title (e.g. "Матрица / The Matrix") |
| year | int | Release year |
| content_type | str | One of: "movie", "serial", "tvshow" |
| genres | list[str] | Genre names (e.g. ["Драма", "Комедия"]) |
| countries | list[str] | Country names (e.g. ["США"]) |
| imdb_rating | float or None | IMDb rating (0.0-10.0) |
| kinopoisk_rating | float or None | Kinopoisk rating (0.0-10.0) |
| plot | str | Brief plot description |
| created_at | str | ISO timestamp when added to catalog |

**Storage**: Turso (cloud SQLite) table `catalog`.
Genres and countries stored as JSON arrays in text columns.

**Identity**: Unique by `id`. Deduplication on insert — if `id`
already exists, entry is skipped (incremental growth).

**Validation**:
- `content_type` must be in `{"movie", "serial", "tvshow"}`
- `id` must be positive integer
- `title` must be non-empty

### Rating

A user's score for a specific movie or series.

| Field | Type | Description |
|-------|------|-------------|
| content_id | int | kino.pub item identifier (primary key) |
| title | str | Display title at time of rating |
| content_type | str | Content type at time of rating |
| score | int | User rating 1-10 |
| rated_at | str | ISO timestamp when rated |

**Storage**: Turso (cloud SQLite) table `ratings`.

**Identity**: Unique by `content_id`. One rating per title
(series rated as a whole, not per episode).

**Validation**:
- `score` must be integer in range [1, 10]
- `content_id` must be positive integer

### Recommendation

A suggested movie or series with reasoning. Transient — generated
per request, not persisted.

| Field | Type | Description |
|-------|------|-------------|
| content_id | int | kino.pub item identifier |
| title | str | Display title |
| year | int | Release year |
| content_type | str | Content type |
| explanation | str | Why this was recommended |

**Storage**: Not persisted. Generated by LLM per `recommend`
invocation.

## Relationships

```
CatalogEntry --(id = content_id)--> Rating  (optional: rated items)
CatalogEntry --(id = content_id)--> Recommendation  (selected from catalog)
```

The `recommend` command selects from `CatalogEntry` records,
filtered to exclude already-rated items if desired, and returns
`Recommendation` objects.

## Storage Schema (Turso / SQLite)

```sql
CREATE TABLE IF NOT EXISTS catalog (
    id INTEGER PRIMARY KEY,
    title TEXT NOT NULL,
    year INTEGER NOT NULL,
    content_type TEXT NOT NULL,
    genres TEXT NOT NULL DEFAULT '[]',
    countries TEXT NOT NULL DEFAULT '[]',
    imdb_rating REAL,
    kinopoisk_rating REAL,
    plot TEXT NOT NULL DEFAULT '',
    created_at TEXT NOT NULL
);

CREATE TABLE IF NOT EXISTS ratings (
    content_id INTEGER PRIMARY KEY,
    title TEXT NOT NULL,
    content_type TEXT NOT NULL,
    score INTEGER NOT NULL CHECK (score >= 1 AND score <= 10),
    rated_at TEXT NOT NULL
);
```
